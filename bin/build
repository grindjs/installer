#!/usr/bin/env bash

source ${0%/*}/.init

strip_babel() {
	cp "$1" "$1-tmp"
	cat "$1-tmp" | sed "s/require('babel-register')//g" > "$1"
	rm "$1-tmp"
}

echo "Cleaning up old build"
rm -fr lib

echo "Building"
mkdir -p lib/app lib/boot
BABEL_TARGET_VERSION=8.7 babel -s inline -d lib/app/ app/ --copy-files
BABEL_TARGET_VERSION=8.7 babel -s inline -d lib/boot/ boot/ --copy-files
strip_babel lib/boot/Cli.js

echo "Done"
